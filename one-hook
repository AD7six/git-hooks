#!/usr/bin/env php
<?php
require  dirname($_SERVER['SCRIPT_FILENAME']) . '/config.php';
$file = basename($_SERVER['SCRIPT_FILENAME']);
if (empty($config[$file])) {
	exit(0);
}

$exit = 0;

foreach ($config[$file] as $command => $halt) {
	if (is_numeric($command)) {
		$command = $halt;
		$halt = false;
	}
	echo "running $command ... \t";
    $output = array();
    $return = 0;
    exec(__DIR__ . "/$command", $output, $return);
    if ($return) {
        echo "FAIL\n";
		$exit = 1;
        echo implode("\n", $output) . "\n";
		if ($halt) {
			exit ($exit);
		}
    } else {
        echo "OK\n";
    }
}

exit ($exit);
